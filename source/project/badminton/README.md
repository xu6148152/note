# Badminton

### 难点
  * 模块重用，如用户系统
    * 封装用户系统业务，数据流动由各自``ViewModel``保存传入用户系统
  * ``sensor``数据同步
    * 多生产者/单消费者模型，多个``Sensor``(最多四个)产生数据，插入数据库，一个回合最多四个``Sensor``的数据传完，保证sensor数据属于同一个回合，(10s超时，没有数据，进入下一组)通知单个(``HandlerThread``)队列从数据库读取最老数据，传入算法，得出结果
  * 视频选择性同步
    * 精彩视频和集锦同步，其余不同步。但分享也能上传视频。采用``IntentService``，将所有未上传视频取出，按比赛分组，先将所有视频的``s_id``至为``-1``，筛选出需要上传的视频置为``null``，上传。分享单独直接使用上传``API``，上传视频需注意分为两部分，一部分上传到七牛，成功之后才能上传到leanCloud，因此``fileId, mediaId``的使用来记录这些信息
  * ``sensor``分配，连接``Sensor``的状态需要实时改变到``ui``上。使用``GameUserManager``来记录这些信息
  * 视频裁剪(``MediaCodec``，离线数据裁剪)，使用``mp4parser``来裁剪，采用关键帧裁剪，有可能会出现无效视频
  * 机器适配(包括视频播放(花屏，根据现象找问题，确认问题所在，视频本身问题或者是机器问题)，权限管理(AppOpsManager,6.0之前的权限控制))
  * 集锦制作，后台调度
    * 需要保存制作过程得各种状态，各个状态通过``msg``来通知``IntentService``，需要注意退出``app``需要杀进程，否则``IntentService``里面可能还有需要制作的视频
    * 崩溃的``log``